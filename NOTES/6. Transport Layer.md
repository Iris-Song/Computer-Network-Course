# Transport Layer
provide data transport from a process on a source machine to a process on a destination machine with a desired level of reliablity that is independent of the physical networks.

## The Transport Service
+ Just as there are two types of network service, connection-oriented and connectionless, there are also two types of transport service.
+ connections have three phases: establishment, data transfer, and release.
+ **if the transport layer service is so similar to the network layer service, why are there two distinct layers?**
  + The transport code runs entirely on the users' machines, but the network layer mostly run on the routers, which are operated by the carriers.
  + The users have no real control over the network layer, so they cannot solve the problem of poor service by using better routers or putting more error handling in the data link layer because they don't own the routers. The only possibility is to put on top of the network layer another layer that improve the quality of service.
### Transport Service Primitives
+ the transport primitives can be implemented as calls to library procedures to make them independent of the network primitives.
+ The transport service is similar to the network service, but there are also differences.
   + The main diffrence is that the network service is intended to model the service offered by real networks, warts and all. Real networks can lose packets, so the network service is generally unreliable.
   + Whom the services are intended for. The network service is used only by the transport entities. Few users write their own transport entities. In contrast, many programs (and thus programmers) see the transport primitives.
   
![](./img/The%20primitives%20for%20a%20simple%20transport%20service.png)

![](./img/Nesting%20of%20segments,%20packets,%20and%20frames.png)
  + In the asymmetric variant, either transport user can issue a DISCONNECT primitive, which results in a DISCONNECT segment being sent to the remote transport entity. Upon its arrival, the connection is released.
  + In the symmetric variant, each direction is closed separately. When one side does a DISCONNECT, that means it has no more data to send but it is still willing to accept data from its partner. In this model, a connection is released when both sides have done a DISCONNECT.

### Berkley Sockets
![](./img/The%20socket%20primitives%20for%20TCP..png
)
+ BIND is not required since the address used does not matter to the server
+ connection release with sockets is symmetric
+ The socket API is often used with the TCP protocol to provide a connection-oriented service called a **reliable byte stream**
+ Sockets can also be used with transport protocols that provide a message stream rather than a byte stream and that do or do not have congestion control. **DCCP** (Datagram Congestion Controlled Protocol) is a version of UDP with congestion control

## Transport Protocol
At the data link layer, two routers communicate directly via a physical channel, whether wired or wireless, whereas at the transport layer, this physical channel is replaced by the entire network.
![](./img/(a)%20Environment%20of%20the%20data%20link%20layer.%20(b)%20Environment%20of%20the%20transport%20layer.png)

### Addressing
**TSAP(Transport Service Access Point)** : a specific endpoint in the transport layer
+ permanently attached to a port, e.g. mail server on TCP port 25
+ **portmapper** : when a new service is created, it must register itself with the portmapper, giving both its service name (typically, an ASCII string) and its TSAP. The portmapper records this information in its internal database so that when queries come in later, it will know the answers.

### Connection Establishment
**three-way handshake**: TCP
![](./img/three-way%20handshake.png)

### Connection Release
+ asymmetric release: when one party hangs up, the connection is broken.may result in data loss.
+ symmetric release: Symmetric release treats the connection as two sep- arate unidirectional connections and requires each one to be released separately.
+ First it receives a request from the client, which is all the data the client will send, and then it sends a response to the client. When the Web server is finished with its response, all of the data has been sent in either direction. The server can send the client a warning and abruptly shut the connection. If the client gets this warning, it will release its connection state then and there. If the client does not get the warning, it will eventually realize that the server is no long- er talking to it and release the connection state. The data has been successfully transferred in either case.

### Error Control and Flow Control
solution are same as in data link layer
1. error-detecting code (e.g. CRC,checksum)
2. ARQ (Automatic Repeat reQuest)
3. stop-and-wait
4. sliding window

still have differences:
+ in function, The link layer checksum protects a frame while it crosses a single link. The transport layer checksum protects a segment while it crosses an entire network path, it is an end-to-end check.
+ in degree, consider retransmissions and the sliding window protocol. transport protocols generally use larger sliding windows.

### multiplexing
When a segment comes in, some way is needed to tell which process to give it to.
**inverse multiplexing** : SCTP (Stream Control Transmission Protocol), can also find in link layer.
![](./img/(a)%20Multiplexing.%20(b)%20Inverse%20multiplexing.png)

### crash recovery

## Congestion Control
### Desirable Bandwidth Allocation
A good allocation will deliver good performance because it uses all the available band- width but avoids congestion, it will be fair across competing transport entities, and it will quickly track changes in traffic demands. 
### Regulating sending rate
sending rate depends on the form of the feedback returned by the network.

The feedback may be explicit or implicit, and it may be precise or imprecise.
+ explicit, precise: when routers tell the sources the rate at which they may send.e.g.XCP(eXplicit Congestion Protocol)
+ explicit, imprecise: ECN (Explicit Congestion Notification) with TCP. In this design, routers set bits on packets that experience congestion to warn the senders to slow down, but they do not tell them how much to slow down.

AIMD (Additive Increase Multiplicative Decrease)
![](./img/Additive%20Increase%20Multiplicative%20Decrease%20(AIMD)%20control%20law.png)

### Wireless issues
